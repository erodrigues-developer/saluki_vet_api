Project {
  database_type: "PostgreSQL" // ou MySQL
}

/*************************************************
 * USUÁRIOS E PERMISSÕES (DENTRO DA CLÍNICA)
 *************************************************/

Table roles {
  id          bigint [pk, increment]
  code        varchar(50) [not null, unique] // ADMIN, VET, RECEPTION...
  name        varchar(100) [not null]
  created_at  datetime [not null]
  updated_at  datetime [not null]
}

Table users {
  id              bigint [pk, increment]
  name            varchar(255) [not null]
  email           varchar(255) [not null, unique]
  password_hash   varchar(255) [not null]
  phone           varchar(50)
  is_active       boolean [not null, default: true]
  last_login_at   datetime
  created_at      datetime [not null]
  updated_at      datetime [not null]
  deleted_at      datetime
}

Table user_roles {
  user_id     bigint [not null, ref: > users.id]
  role_id     bigint [not null, ref: > roles.id]
  created_at  datetime [not null]

  Note: 'Permite múltiplos papéis por usuário'
}

Ref: user_roles.user_id > users.id
Ref: user_roles.role_id > roles.id

/*************************************************
 * CONFIGURAÇÕES DA CLÍNICA (LOCAIS)
 *************************************************/

Table clinic_settings {
  id                                bigint [pk, increment]
  appointment_slot_duration_minutes int    [not null, default: 30]
  business_hours_json               text   // JSON com horários por dia da semana
  logo_url                          varchar(500)
  default_currency                  varchar(10) // BRL
  notes                             text
  created_at                        datetime [not null]
  updated_at                        datetime [not null]
}

/*************************************************
 * CLIENTES (TUTORES) E PETS
 *************************************************/

Table clients {
  id              bigint [pk, increment]
  name            varchar(255) [not null]
  document        varchar(32)           // CPF/CNPJ
  phone           varchar(50)
  mobile_phone    varchar(50)
  email           varchar(255)
  street          varchar(255)
  number          varchar(50)
  complement      varchar(255)
  district        varchar(255)
  city            varchar(255)
  state           varchar(50)
  zip_code        varchar(20)
  notes           text
  is_active       boolean [not null, default: true]
  created_at      datetime [not null]
  updated_at      datetime [not null]
  deleted_at      datetime
}

Table species {
  id          bigint [pk, increment]
  name        varchar(100) [not null]  // Cachorro, Gato...
  created_at  datetime [not null]
  updated_at  datetime [not null]
}

Table breeds {
  id          bigint [pk, increment]
  species_id  bigint [not null, ref: > species.id]
  name        varchar(100) [not null]
  created_at  datetime [not null]
  updated_at  datetime [not null]
}

Table pets {
  id               bigint [pk, increment]
  client_id        bigint [not null, ref: > clients.id]
  name             varchar(255) [not null]
  species_id       bigint [not null, ref: > species.id]
  breed_id         bigint [ref: > breeds.id]
  sex              varchar(10)  // M, F, N…
  date_of_birth    date
  weight_kg        decimal(10,2)
  color            varchar(100)
  microchip_code   varchar(100)
  allergies        text
  chronic_diseases text
  notes            text
  is_active        boolean [not null, default: true]
  created_at       datetime [not null]
  updated_at       datetime [not null]
  deleted_at       datetime
}

/*************************************************
 * AGENDA E AGENDAMENTOS
 *************************************************/

Table appointment_types {
  id                          bigint [pk, increment]
  name                        varchar(100) [not null] // Consulta, Vacinação...
  description                 text
  default_duration_minutes    int [not null, default: 30]
  is_active                   boolean [not null, default: true]
  created_at                  datetime [not null]
  updated_at                  datetime [not null]
}

Table appointment_statuses {
  id          bigint [pk, increment]
  code        varchar(50) [not null, unique] // SCHEDULED, COMPLETED, CANCELED...
  name        varchar(100) [not null]
  is_system   boolean [not null, default: true]
  created_at  datetime [not null]
  updated_at  datetime [not null]
}

Table appointments {
  id                  bigint [pk, increment]
  pet_id              bigint [not null, ref: > pets.id]
  client_id           bigint [not null, ref: > clients.id]
  veterinarian_id     bigint [ref: > users.id]
  appointment_type_id bigint [not null, ref: > appointment_types.id]
  status_id           bigint [not null, ref: > appointment_statuses.id]
  starts_at           datetime [not null]
  ends_at             datetime
  reason              text
  notes               text
  created_by_user_id  bigint [ref: > users.id]
  created_at          datetime [not null]
  updated_at          datetime [not null]
  deleted_at          datetime
}

/*************************************************
 * ATENDIMENTO / CONSULTA
 *************************************************/

Table procedures {
  id              bigint [pk, increment]
  name            varchar(255) [not null] // Consulta Clínica, Curativo…
  description     text
  default_price   decimal(10,2)
  is_active       boolean [not null, default: true]
  created_at      datetime [not null]
  updated_at      datetime [not null]
}

Table consultations {
  id                  bigint [pk, increment]
  appointment_id      bigint [ref: > appointments.id]
  pet_id              bigint [not null, ref: > pets.id]
  client_id           bigint [not null, ref: > clients.id]
  veterinarian_id     bigint [not null, ref: > users.id]
  visit_date          datetime [not null]
  weight_kg           decimal(10,2)
  temperature_c       decimal(5,2)
  main_complaint      text
  clinical_findings   text
  diagnosis           text
  treatment_plan      text
  notes               text
  created_at          datetime [not null]
  updated_at          datetime [not null]
}

Table consultation_procedures {
  id               bigint [pk, increment]
  consultation_id  bigint [not null, ref: > consultations.id]
  procedure_id     bigint [not null, ref: > procedures.id]
  quantity         int    [not null, default: 1]
  unit_price       decimal(10,2) [not null]
  total_price      decimal(10,2) [not null]
}

/*************************************************
 * PRODUTOS, ESTOQUE E VENDAS
 *************************************************/

Table product_categories {
  id          bigint [pk, increment]
  name        varchar(100) [not null]
  description text
  created_at  datetime [not null]
  updated_at  datetime [not null]
}

Table products {
  id                 bigint [pk, increment]
  product_category_id bigint [ref: > product_categories.id]
  name               varchar(255) [not null]
  sku                varchar(100)
  is_service         boolean [not null, default: false] // serviço x produto físico
  unit               varchar(50) // un, ml, kg, dose...
  sale_price         decimal(10,2) [not null, default: 0]
  cost_price         decimal(10,2)
  track_stock        boolean [not null, default: true]
  is_vaccine         boolean [not null, default: false]
  notes              text
  is_active          boolean [not null, default: true]
  created_at         datetime [not null]
  updated_at         datetime [not null]
  deleted_at         datetime
}

Table stock_locations {
  id          bigint [pk, increment]
  name        varchar(100) [not null] // Estoque Principal, Sala de Vacinas...
  is_default  boolean [not null, default: false]
  created_at  datetime [not null]
  updated_at  datetime [not null]
}

Table stock_movements {
  id               bigint [pk, increment]
  product_id       bigint [not null, ref: > products.id]
  stock_location_id bigint [not null, ref: > stock_locations.id]
  movement_type    varchar(20) [not null] // IN, OUT, ADJUSTMENT
  quantity         decimal(10,3) [not null]
  unit_cost        decimal(10,2)
  occurred_at      datetime [not null]
  reference_type   varchar(50)  // SALE, CONSULTATION, ADJUSTMENT...
  reference_id     bigint
  notes            text
  created_at       datetime [not null]
  updated_at       datetime [not null]
}

Table sales {
  id              bigint [pk, increment]
  client_id       bigint [ref: > clients.id]  // pode ser null para balcão
  veterinarian_id bigint [ref: > users.id]
  sale_date       datetime [not null]
  status          varchar(20) [not null, default: 'OPEN'] // OPEN, PAID, CANCELED
  subtotal        decimal(10,2) [not null, default: 0]
  discount_amount decimal(10,2) [not null, default: 0]
  total_amount    decimal(10,2) [not null, default: 0]
  notes           text
  created_at      datetime [not null]
  updated_at      datetime [not null]
}

Table sale_items {
  id              bigint [pk, increment]
  sale_id         bigint [not null, ref: > sales.id]
  product_id      bigint [not null, ref: > products.id]
  quantity        decimal(10,3) [not null, default: 1]
  unit_price      decimal(10,2) [not null]
  discount_amount decimal(10,2) [not null, default: 0]
  total_price     decimal(10,2) [not null]
}

/*************************************************
 * FINANCEIRO ESSENCIAL (PAGAMENTOS)
 *************************************************/

Table payment_methods {
  id          bigint [pk, increment]
  code        varchar(50) [not null]  // CASH, CARD, PIX, OTHER...
  name        varchar(100) [not null]
  is_active   boolean [not null, default: true]
  created_at  datetime [not null]
  updated_at  datetime [not null]
}

Table payments {
  id                bigint [pk, increment]
  sale_id           bigint [not null, ref: > sales.id]
  payment_method_id bigint [not null, ref: > payment_methods.id]
  amount            decimal(10,2) [not null]
  paid_at           datetime [not null]
  notes             text
  created_at        datetime [not null]
  updated_at        datetime [not null]
}

/*************************************************
 * VACINAS E CARTEIRA VACINAL
 *************************************************/

Table vaccines {
  id                    bigint [pk, increment]
  name                  varchar(255) [not null]
  manufacturer          varchar(255)
  description           text
  default_interval_days int
  created_at            datetime [not null]
  updated_at            datetime [not null]
}

Table pet_vaccines {
  id               bigint [pk, increment]
  pet_id           bigint [not null, ref: > pets.id]
  vaccine_id       bigint [not null, ref: > vaccines.id]
  consultation_id  bigint [ref: > consultations.id]
  application_date date [not null]
  due_date         date
  batch_number     varchar(100)
  veterinarian_id  bigint [ref: > users.id]
  notes            text
  created_at       datetime [not null]
  updated_at       datetime [not null]
}
